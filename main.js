(()=>{"use strict";var t={baseUrl:"https://nomoreparties.co/v1/cohort-mag-4",headers:{authorization:"929e59f8-718a-413d-aeb7-fc29da52656d","Content-Type":"application/json"}};function e(e){return fetch(t.baseUrl+"/".concat(e),{headers:t.headers})}function n(e,n){return fetch(t.baseUrl+"/".concat(e),{method:"PATCH",headers:t.headers,body:JSON.stringify(n)})}function r(e,n){return fetch(t.baseUrl+"/".concat(e,"/").concat(n),{method:"DELETE",headers:t.headers})}function o(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}function c(t){return function(t){if(Array.isArray(t))return a(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return a(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var i=document.querySelector("#card-template");function u(t,e,n,r,o){var c=function(){var t=i.content.querySelector(".card").cloneNode(!0),e=t.querySelector(".card__delete-button"),n=t.querySelector(".card__title"),r=t.querySelector(".card__image"),o=t.querySelector(".card__like-button"),c=t.querySelector(".card__like-count");return{card:t,deleteBtn:e,likeBtn:o,cardTitle:n,cardImage:r,cardLikeCount:c}}(),a=c.card,u=c.deleteBtn,l=c.likeBtn,s=c.cardTitle,d=c.cardImage,f=c.cardLikeCount,p=t._id;return"likes"in t&&(t.likes.find((function(t){return t._id===o}))&&l.classList.add("card__like-button_is-active"),f.textContent=t.likes.length),"owner"in t&&(t.owner._id===o?u.addEventListener("click",(function(t){e(t,p)})):u.classList.add("card__delete-button_hidden")),l.addEventListener("click",(function(e){n(e,p,t,f)})),d.addEventListener("click",(function(e){r(e,t)})),s.textContent=t.name,d.src=t.link,d.alt=t.name,a}function l(t,e){var n=t.target.closest(".places__item");(function(t){return r("cards",t).then((function(t){return o(t)}))})(e).then((function(){n.remove()})).catch((function(t){console.log(t)}))}function s(e,n,a,i){e.target.classList.contains("card__like-button_is-active")?function(t){return r("cards/likes",t).then((function(t){return o(t)}))}(n).then((function(t){a.likes=c(t.likes),i.textContent=a.likes.length,e.target.classList.toggle("card__like-button_is-active")})).catch((function(t){console.log(t)})):function(e){return function(e,n){return fetch(t.baseUrl+"/".concat("cards/likes","/").concat(n),{method:"PUT",headers:t.headers})}(0,e).then((function(t){return o(t)}))}(n).then((function(t){a.likes=c(t.likes),i.textContent=a.likes.length,e.target.classList.toggle("card__like-button_is-active")})).catch((function(t){console.log(t)}))}function d(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",p)}function f(t){document.removeEventListener("keydown",p),t.classList.remove("popup_is-opened")}function p(t){"Escape"===t.key&&f(document.querySelector(".popup_is-opened"))}function m(t,e){var n=t.querySelector(e.submitButtonSelector),r=Array.from(t.querySelectorAll(e.inputSelector));r.forEach((function(n){b(t,n,e)})),y(r,n,e)}function _(t,e){t.classList.add(e.inactiveButtonClass),t.disabled=!0}function y(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.classList.remove(n.inactiveButtonClass),e.disabled=!1):(e.classList.add(n.inactiveButtonClass),e.disabled=!0)}var v=function(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?b(t,e,n):h(t,e,e.validationMessage,n)},h=function(t,e,n,r){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)},b=function(t,e,n){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""};function S(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var g,k=".popup",q=".popup__button",C={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},L=[{selector:".popup__close",action:function(t){f(t.closest(k))}},{selector:k,action:function(t){f(t)}}],E=null,A=document.forms["edit-profile"],x=document.forms["new-place"],B=document.forms["edit-avatar"],w=document.querySelector(".places__list"),j=document.querySelector(".popup_type_edit"),T=document.querySelector(".popup_type_new-card"),U=document.querySelector(".popup_type_image"),I=document.querySelector(".page__content"),O=document.querySelector(".profile__title"),D=document.querySelector(".profile__description"),M=document.querySelector(".profile__image"),P=document.querySelector(".profile__edit-button"),N=document.querySelector(".profile__add-button"),J=document.querySelector(".popup_type_avatar"),V=document.querySelector(".popup__image"),$=document.querySelector(".popup__caption"),z=document.querySelector(".popup__form"),F=z.querySelector(".popup__input_type_name"),H=z.querySelector(".popup__input_type_description"),G=document.createDocumentFragment();function K(t,e){V.setAttribute("src",e.link),V.setAttribute("alt",e.name),$.textContent=e.name,d(U)}function Q(t){O.textContent=t.name,D.textContent=t.about,M.style="background-image: url('".concat(t.avatar,"')")}function R(t,e){e.textContent=t?"Сохранение...":"Сохранить"}Promise.all([e("cards").then((function(t){return o(t)})),e("users/me").then((function(t){return o(t)}))]).then((function(t){var e,n,r=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,c,a,i=[],u=!0,l=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=c.call(n)).done)&&(i.push(r.value),i.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return i}}(e,n)||function(t,e){if(t){if("string"==typeof t)return S(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?S(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],c=r[1];return E=c._id,o.forEach((function(t){var e=u(t,l,s,K,E);G.appendChild(e)})),{fragment:G,user:c}})).then((function(t){var e=t.fragment;Q(t.user),w.appendChild(e)})).catch((function(t){console.log(t)})),I.addEventListener("click",(function(t){var e=t.target,n=L.find((function(t){return e.matches(t.selector)}));n&&n.action(e)})),P.addEventListener("click",(function(){A.name.value=O.textContent,A.description.value=D.textContent,m(j,C),d(j)})),N.addEventListener("click",(function(){d(T)})),M.addEventListener("click",(function(){m(J,C),B.reset(),d(J)})),x.addEventListener("submit",(function(e){e.preventDefault();var n,r,c,a=e.target.querySelector(q),i=x["place-name"].value,d=x.link.value;R(!0,a),_(a,C),(n=i,r=d,(c={name:n,link:r},fetch(t.baseUrl+"/".concat("cards"),{method:"POST",headers:t.headers,body:JSON.stringify(c)})).then((function(t){return o(t)}))).then((function(t){var n=u(t,l,s,K,E),r=document.querySelector(".places__list");r.insertBefore(n,r.firstChild),f(e.target.closest(k)),x.reset()})).catch((function(t){console.log(t)})).finally((function(){R(!1,a)}))})),B.addEventListener("submit",(function(t){t.preventDefault();var e,r=t.target.querySelector(q),c=B.link.value;R(!0,r),_(r,C),(e=c,n("users/me/avatar",{avatar:e}).then((function(t){return o(t)}))).then((function(e){Q(e),f(t.target.closest(k))})).catch((function(t){console.log(t)})).finally((function(){R(!1,r)}))})),A.addEventListener("submit",(function(t){var e,r,c=t.target.querySelector(q);t.preventDefault(),R(!0,c),_(c,C),(e=F.value,r=H.value,n("users/me",{name:e,about:r}).then((function(t){return o(t)}))).then((function(e){O.textContent=e.name,D.textContent=e.about,f(t.target.closest(k))})).catch((function(t){console.log(t)})).finally((function(){R(!1,c)}))})),g=C,Array.from(document.querySelectorAll(g.formSelector)).forEach((function(t){!function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);y(n,r,e),n.forEach((function(o){o.addEventListener("input",(function(){v(t,o,e),y(n,r,e)}))}))}(t,g)}))})();